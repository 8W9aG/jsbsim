<!--

  Author:   Jon Berndt
  Date:     18 August 2002
  Function: C-172 autopilot test file

  Note: this file represents a test only of the new autopilot
        setup in JSBSim. The same components used in the FCS
        can also be used in the autopilot section. There are
        some new FCS input and output identifiers directly
        related to the autopilot:

          ap/elevator_cmd,
          ap/aileron_cmd,
          ap/rudder_cmd,
          ap/throttle_cmd,
          ap/set_attitude,
          ap/set_altitude,
          ap/set_heading,
          ap/set_airspeed,
          ap/acquire_attitude,
          ap/acquire_altitude,
          ap/acquire_heading,
          ap/acquire_aispeed,
          ap/attitude_hold,
          ap/altitude_hold,
          ap/heading_hold,
          ap/airspeed_hold,
          ap/wingslevel_hold

-->

<!--
=====================================================
ROLL CHANNEL
=====================================================
-->

<!-- Wing leveler -->

<COMPONENT NAME="Roll A/P Wing Leveler" TYPE="PURE_GAIN">
   INPUT         attitude/phi-rad
   GAIN          2.0
   MIN           -0.255
   MAX            0.255
</COMPONENT>

<COMPONENT NAME="Roll A/P Error Integrator" TYPE="INTEGRATOR">
   INPUT         attitude/phi-rad
   C1            0.125
</COMPONENT>

<COMPONENT NAME="Roll A/P Error summer" TYPE="SUMMER">
   INPUT         velocities/p-rad_sec
   INPUT         fcs/roll-ap-wing-leveler
   INPUT         fcs/roll-ap-error-integrator
   CLIPTO       -1.0 1.0
</COMPONENT>

<COMPONENT NAME="Roll A/P Autoswitch" TYPE="SWITCH">
  <TEST LOGIC="DEFAULT" VALUE="0.0">
  </TEST>
  <TEST LOGIC="AND" VALUE="fcs/roll-ap-error-summer">
    ap/attitude_hold == 1
  </TEST>
</COMPONENT>

<COMPONENT NAME="Roll A/P Aileron Command Normalizer" TYPE="PURE_GAIN">
   INPUT         fcs/roll-ap-autoswitch
   GAIN          -1
</COMPONENT>


<!-- Heading hold -->

<COMPONENT NAME="Heading True Degrees" TYPE="PURE_GAIN">
  INPUT         attitude/heading-true-rad
  GAIN          57.3 <!-- convert to degrees -->
</COMPONENT>

<COMPONENT NAME="Heading Error" TYPE="SUMMER">
  INPUT         -fcs/heading-true-degrees
  INPUT          ap/heading_setpoint
</COMPONENT>

<COMPONENT NAME="Heading Error Bias Switch" TYPE="SWITCH">
  <TEST LOGIC="DEFAULT" VALUE="0.0">
  </TEST>
  <TEST LOGIC="AND" VALUE="360.0">
    fcs/heading-error < -180
  </TEST>
  <TEST LOGIC="AND" VALUE="-360.0">
    fcs/heading-error > 180
  </TEST>
</COMPONENT>

<COMPONENT NAME="Heading Corrected" TYPE="SUMMER">
  INPUT          fcs/heading-error-bias-switch
  INPUT          fcs/heading-error
  CLIPTO         -30 30
</COMPONENT>

<COMPONENT NAME="Heading Command" TYPE="PURE_GAIN">
  INPUT          fcs/heading-corrected
  GAIN           0.01745
</COMPONENT>

<COMPONENT NAME="Heading Roll Error Lag" TYPE="LAG_FILTER">
  INPUT          fcs/heading-command
  C1             0.50
</COMPONENT>

<COMPONENT NAME="Heading Roll Error" TYPE="SUMMER">
  INPUT          fcs/heading-roll-error-lag
  INPUT         -attitude/phi-rad
</COMPONENT>

<COMPONENT NAME="Heading Roll Error Switch" TYPE="SWITCH">
  <TEST LOGIC="DEFAULT" VALUE="0.0">
  </TEST>
  <TEST LOGIC="AND" VALUE="fcs/heading-roll-error">
    ap/heading_hold == 1
  </TEST>
</COMPONENT>

<COMPONENT NAME="Heading Proportional" TYPE="PURE_GAIN">
  INPUT          fcs/heading-roll-error-switch
  GAIN           1.0
</COMPONENT>

<COMPONENT NAME="Heading Integral" TYPE="INTEGRATOR">
  INPUT          fcs/heading-roll-error-switch
  C1             0.10
</COMPONENT>

<COMPONENT NAME="Heading Error Summer" TYPE="SUMMER">
  INPUT          fcs/heading-integral
  INPUT          fcs/heading-proportional
  CLIPTO         -1.0 1.0
</COMPONENT>

<COMPONENT NAME="Roll Command Selector" TYPE="SWITCH">
  <TEST LOGIC="DEFAULT" VALUE="0.0">
  </TEST>
  <TEST LOGIC="AND" VALUE="fcs/heading-error-summer">
    ap/heading_hold == 1
  </TEST>
  <TEST LOGIC="AND" VALUE="fcs/roll-ap-aileron-command-normalizer">
    ap/attitude_hold == 1
  </TEST>
  OUTPUT ap/aileron_cmd
</COMPONENT>

<!--
=====================================================
PITCH CHANNEL
=====================================================
-->

<!-- Altitude hold -->

<!-- The Altitude Error component below computes the altitude error, subtracting
     the desired altitude (altitude_setpoint) from the actual altitude above sea
     level (_not_ Above Ground Level).  This error signal is interpreted as an
     hdot command (hdot is time rate of change of altitude, or rate of climb). As
     such it is limited to a maximum absolute value of 10 fps here (600 fpm).
-->

<COMPONENT NAME="Altitude Error" TYPE="SUMMER">
  INPUT         -position/h-sl-ft
  INPUT          ap/altitude_setpoint
  CLIPTO        -100.0 100.0
</COMPONENT>

<COMPONENT NAME="Alt Error Lag" TYPE="LAG_FILTER">
  INPUT          fcs/altitude-error
  C1             0.25
</COMPONENT>

<COMPONENT NAME="HDot Command" TYPE="SCHEDULED_GAIN">
  INPUT          fcs/alt-error-lag
  SCHEDULED_BY   position/h-sl-ft
  ROWS           13
  0     0.12
  1000  0.11
  2000  0.10
  3000  0.096
  4000  0.093
  5000  0.086
  6000  0.078
  7000  0.069
  8000  0.061
  9000  0.053
  10000 0.045
  11000 0.037
  12000 0.028
</COMPONENT>

<COMPONENT NAME="HDot Error" TYPE="SUMMER">
  INPUT          fcs/hdot-command
  INPUT         -velocities/h-dot-fps
</COMPONENT>

<COMPONENT NAME="AP Alt Hold Switch" TYPE="SWITCH">
  <TEST LOGIC="DEFAULT" VALUE="0.0">
  </TEST>
  <TEST LOGIC="AND" VALUE="fcs/hdot-error">
    ap/altitude_hold == 1
  </TEST>
</COMPONENT>

<COMPONENT NAME="Integral" TYPE="INTEGRATOR">
  INPUT          fcs/ap-alt-hold-switch
  C1             0.00000001
</COMPONENT>

<COMPONENT NAME="Proportional" TYPE="PURE_GAIN">
  INPUT          fcs/ap-alt-hold-switch
  GAIN           0.035
</COMPONENT>

<COMPONENT NAME="Control Summer" TYPE="SUMMER">
  INPUT          fcs/integral
  INPUT          fcs/proportional
  CLIPTO         -1.0 1.0
</COMPONENT>

<COMPONENT NAME="Elevator" TYPE="PURE_GAIN">
  INPUT          fcs/control-summer
  GAIN          -1.0
  OUTPUT         ap/elevator_cmd
</COMPONENT>


